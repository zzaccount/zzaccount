<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>爬虫相关介绍 | shankele-小站</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/style.css">
    <script charset="utf-8" src="/js/custom.js"></script>
    <meta name="description" content="he">
    <meta name="keywords" content="shankele,个人博客,前端,GIS">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="robots" content="all">
    <meta name="author" content="shankele">
    
    <link rel="preload" href="/assets/css/0.styles.9c79f0a4.css" as="style"><link rel="preload" href="/assets/js/app.ab61940f.js" as="script"><link rel="preload" href="/assets/js/4.af0e03a7.js" as="script"><link rel="preload" href="/assets/js/1.d11c8c07.js" as="script"><link rel="preload" href="/assets/js/15.55dfe66d.js" as="script"><link rel="preload" href="/assets/js/10.29aea2aa.js" as="script"><link rel="prefetch" href="/assets/js/11.98f4216c.js"><link rel="prefetch" href="/assets/js/12.e661133b.js"><link rel="prefetch" href="/assets/js/13.d3edd8ce.js"><link rel="prefetch" href="/assets/js/14.8191e329.js"><link rel="prefetch" href="/assets/js/16.9782e075.js"><link rel="prefetch" href="/assets/js/17.93b2f660.js"><link rel="prefetch" href="/assets/js/5.df97f0b8.js"><link rel="prefetch" href="/assets/js/6.77d5cdd1.js"><link rel="prefetch" href="/assets/js/7.2f59456a.js"><link rel="prefetch" href="/assets/js/8.eb712547.js"><link rel="prefetch" href="/assets/js/9.ab7f46d7.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.4e07c609.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9c79f0a4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container" data-v-4698c43e><div data-v-4698c43e><div id="loader-wrapper" class="loading-wrapper" data-v-1c4f0192 data-v-4698c43e data-v-4698c43e><div class="loader-main" data-v-1c4f0192><div data-v-1c4f0192></div><div data-v-1c4f0192></div><div data-v-1c4f0192></div><div data-v-1c4f0192></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-6cbeab0a data-v-4698c43e data-v-4698c43e><h3 class="title" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a>shankele-小站</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><input type="password" value="" data-v-6cbeab0a> <span data-v-6cbeab0a>Konck! Knock!</span> <button data-v-6cbeab0a>OK</button></label> <div class="footer" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><span data-v-6cbeab0a><i class="iconfont reco-theme" data-v-6cbeab0a></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-6cbeab0a>vuePress-theme-reco</a></span> <span data-v-6cbeab0a><i class="iconfont reco-copyright" data-v-6cbeab0a></i> <a data-v-6cbeab0a><span data-v-6cbeab0a>shankele</span>
            
          <span data-v-6cbeab0a>2022 - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-4698c43e><header class="navbar" data-v-4698c43e><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">shankele-小站</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link"><i class="iconfont reco-eye"></i>
  本站指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/技术文章/vue/Vue.html" class="nav-link"><i class="iconfont undefined"></i>
  VUE
</a></li></ul></li><li class="dropdown-item"><h4>javascript</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/技术文章/JavaScript/JavaScript.html" class="nav-link"><i class="iconfont undefined"></i>
  javascript
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      后端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/技术文章/Python/爬虫.html" class="nav-link"><i class="iconfont undefined"></i>
  Python爬虫基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-faq"></i>
      生活分享
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/生活分享/life.html" class="nav-link"><i class="iconfont undefined"></i>
  生活分享
</a></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-4698c43e></div> <aside class="sidebar" data-v-4698c43e><div class="personal-info-wrapper" data-v-6c8ffc9c><img src="/avatar.jpg" alt="author-avatar" class="personal-img" data-v-6c8ffc9c> <h3 class="name" data-v-6c8ffc9c>
    shankele
  </h3> <div class="num" data-v-6c8ffc9c><div data-v-6c8ffc9c><h3 data-v-6c8ffc9c>3</h3> <h6 data-v-6c8ffc9c>文章</h6></div> <div data-v-6c8ffc9c><h3 data-v-6c8ffc9c>6</h3> <h6 data-v-6c8ffc9c>标签</h6></div></div> <hr data-v-6c8ffc9c></div> <nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link"><i class="iconfont reco-eye"></i>
  本站指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/技术文章/vue/Vue.html" class="nav-link"><i class="iconfont undefined"></i>
  VUE
</a></li></ul></li><li class="dropdown-item"><h4>javascript</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/技术文章/JavaScript/JavaScript.html" class="nav-link"><i class="iconfont undefined"></i>
  javascript
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      后端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/技术文章/Python/爬虫.html" class="nav-link"><i class="iconfont undefined"></i>
  Python爬虫基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-faq"></i>
      生活分享
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/生活分享/life.html" class="nav-link"><i class="iconfont undefined"></i>
  生活分享
</a></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Python</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/技术文章/Python/爬虫.html" class="active sidebar-link">爬虫相关介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/技术文章/Python/爬虫.html#爬虫相关介绍" class="sidebar-link">爬虫相关介绍</a></li><li class="sidebar-sub-header"><a href="/技术文章/Python/爬虫.html#requests基础操作" class="sidebar-link">requests基础操作</a></li><li class="sidebar-sub-header"><a href="/技术文章/Python/爬虫.html#数据解析" class="sidebar-link">数据解析</a></li></ul></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-6cbeab0a data-v-4698c43e><h3 class="title" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a></h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><input type="password" value="" data-v-6cbeab0a> <span data-v-6cbeab0a>Konck! Knock!</span> <button data-v-6cbeab0a>OK</button></label> <div class="footer" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><span data-v-6cbeab0a><i class="iconfont reco-theme" data-v-6cbeab0a></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-6cbeab0a>vuePress-theme-reco</a></span> <span data-v-6cbeab0a><i class="iconfont reco-copyright" data-v-6cbeab0a></i> <a data-v-6cbeab0a><span data-v-6cbeab0a>shankele</span>
            
          <span data-v-6cbeab0a>2022 - </span>
          2022
        </a></span></div></div> <div data-v-4698c43e><main class="page"><!----> <div class="page-title" style="display:none;"><h1>爬虫相关介绍</h1> <hr> <div data-v-484a899e><i class="iconfont reco-account" data-v-484a899e><span data-v-484a899e>shankele</span></i> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default" style="display:none;"><h2 id="爬虫相关介绍"><a href="#爬虫相关介绍" class="header-anchor">#</a> 爬虫相关介绍</h2> <p>爬虫在应用场景的分类</p> <ul><li>通用爬虫：
<ul><li>将一个页面中所有的数据获取。</li> <li>大部分的搜索引擎中应用比较多。</li></ul></li> <li>聚焦爬虫
<ul><li>将页面中局部的指定的数据进行提取/抓取</li> <li>注意：聚焦爬虫一定是建立在通用爬虫的基础之上实现。</li></ul></li> <li>功能爬虫
<ul><li>通过浏览器或者app自动化的操作，实现相关的网页或者app自动化的操作。代替人工在网页或者手机软件中自动执行相关的行为动作。</li> <li>批量点赞，批量评论，刷单,秒杀.....</li></ul></li> <li>增量式爬虫
<ul><li>用来监测网站数据更新的情况。以便爬取网站最新更新出来的数据！</li></ul></li> <li>分布式爬虫
<ul><li>可以对网站所有的资源使用分布式机群进行分布和联合的数据爬取</li></ul></li></ul> <h2 id="requests基础操作"><a href="#requests基础操作" class="header-anchor">#</a> requests基础操作</h2> <ul><li><p>基本介绍</p> <ul><li>requests就是爬虫中一个基于网络请求的模块。</li> <li>作用：模拟浏览器上网的。</li> <li>urllib模块就是一个老版的requests模块，现在没人用urllib</li></ul></li> <li><p>环境安装</p> <ul><li>pip install requests</li></ul></li> <li><p>编码流程</p> <ul><li>指定url（好比打开浏览器输入网址）</li> <li>发起请求（好比是按下回车）</li> <li>获取响应数据（从指定url中爬取到的数据）</li> <li>持久化存储</li></ul></li> <li><p>案例应用</p> <ul><li><p>搜狗首页数据采集</p> <ul><li><p>https://www.sogou.com/</p></li> <li><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests

<span class="token comment">#1,指定url</span>
url <span class="token operator">=</span> <span class="token string">'https://www.sogou.com/'</span>

<span class="token comment">#2,发起请求（只要在浏览器地址栏输入网址按下回车，发起的一定get请求）</span>
<span class="token comment">#url为get方法的第一个参数，表示根据指定的url发起get请求</span>
<span class="token comment">#get方法会返回一个响应对象</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">)</span> <span class="token comment">#get使用来使用requests模块发起get请求</span>

<span class="token comment">#3.获取响应数据/爬取到的数据</span>
page_text <span class="token operator">=</span> response<span class="token punctuation">.</span>text <span class="token comment">#text属性使用来返回字符串形式的响应数据</span>
<span class="token comment"># print(page_text)</span>

<span class="token comment">#4.持久化存储</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./sogou.html'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>page_text<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'数据爬取存储成功！'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li></ul></li> <li><p>简易的网页采集器</p> <ul><li><p>注意：在浏览器的地址栏中网址，网址？后面的内容就是请求的参数（请求参数）</p> <ul><li>https://www.sogou.com/web?query=jay</li> <li>query=jay就是请求的参数
<ul><li>请求参数就是客户端发送给服务端的数据</li></ul></li></ul></li> <li><p>https://www.sogou.com/</p></li> <li><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests

<span class="token comment">#请求参数动态化</span>
keyword <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入关键字:'</span><span class="token punctuation">)</span>
<span class="token comment">#稍后想要把该字典作为请求参数</span>
pram <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'query'</span><span class="token punctuation">:</span>keyword<span class="token punctuation">,</span> <span class="token comment">#只存在一个键值对（存在一组请求参数）</span>
<span class="token punctuation">}</span>
<span class="token comment">#1.指定url</span>
url <span class="token operator">=</span> <span class="token string">'https://www.sogou.com/web'</span> <span class="token comment">#需要将请求参数去除</span>
<span class="token comment">#2.发起请求</span>
<span class="token comment">#params参数就是用来在请求时携带指定的请求参数</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>params<span class="token operator">=</span>pram<span class="token punctuation">)</span>

<span class="token comment">#3.获取响应数据</span>
page_text <span class="token operator">=</span> response<span class="token punctuation">.</span>text

<span class="token comment">#4.持久化存储</span>
fileName <span class="token operator">=</span> keyword <span class="token operator">+</span> <span class="token string">'.html'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>page_text<span class="token punctuation">)</span>


<span class="token comment">#出问题：没有爬取到我们想要的数据？原因是因为遇到反爬机制</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></li> <li><p>分析该网站的反爬机制：</p> <ul><li>从爬取到的内容中提取到了一个关键信息：网站检测到了异常的访问请求
<ul><li>异常的访问请求：通过程序发起的请求</li> <li>正常访问请求：通过浏览器发起的请求</li></ul></li> <li>网站如何可以监测请求是不是通过浏览器发起的呢？
<ul><li>是通过请求的一个头信息：user-agent</li> <li>user-agent：请求载体的身份标识</li></ul></li> <li>破解方式（UA伪装）：伪装请求载体的身份标识
<ul><li>该反爬机制是一种最常见最通用的，也就是说绝大数网站都会携带该反爬机制，因此日后写爬虫程序，默认带上UA伪装操作。</li></ul></li></ul></li> <li><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests

<span class="token comment">#请求参数动态化</span>
keyword <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入关键字:'</span><span class="token punctuation">)</span>
<span class="token comment">#稍后想要把该字典作为请求参数</span>
pram <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'query'</span><span class="token punctuation">:</span>keyword<span class="token punctuation">,</span> <span class="token comment">#只存在一个键值对（存在一组请求参数）</span>
<span class="token punctuation">}</span>
<span class="token comment">#1.指定url</span>
url <span class="token operator">=</span> <span class="token string">'https://www.sogou.com/web'</span> <span class="token comment">#需要将请求参数去除</span>
<span class="token comment">#2.发起请求</span>
head <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">#存放需要伪装的头信息</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36'</span>
<span class="token punctuation">}</span>
<span class="token comment">#通过headers参数进行了头信息的伪装</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>params<span class="token operator">=</span>pram<span class="token punctuation">,</span>headers<span class="token operator">=</span>head<span class="token punctuation">)</span>

<span class="token comment">#3.获取响应数据</span>
page_text <span class="token operator">=</span> response<span class="token punctuation">.</span>text

<span class="token comment">#4.持久化存储</span>
fileName <span class="token operator">=</span> keyword <span class="token operator">+</span> <span class="token string">'.html'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>page_text<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></li></ul></li> <li><p>豆瓣电影</p> <ul><li><p>https://movie.douban.com/typerank?type_name=%E7%88%B1%E6%83%85&amp;type=13&amp;interval_id=100:90&amp;action=</p> <ul><li><p>爬取电影的详情数据</p></li> <li><p>对网站进行分析：</p> <ul><li><p>1.在抓包工具中先定位到和浏览器地址栏的网址一样的数据包</p></li> <li><p>2.查看开发者工具中，定位到的数据包中的response这一项，该项中存放的就是对定位到数据包的url发起请求，请求到的数据。</p></li> <li><p>3.在response选项卡中查看是否存在我们想要爬取的数据：</p> <ul><li><p>如何检测是否存在我们想要爬取的数据呢？</p> <ul><li><p>局部搜索：将你想要爬取的局部数据，在response进行搜索，查看是否可以搜索到。</p> <ul><li><p>搜索到了：</p> <ul><li>可以直接对该数据包的url发起请求获取你想要的数据即可</li></ul></li> <li><p>搜索不到：</p> <ul><li>说明你想要的数据是【动态加载数据】</li> <li>什么是动态加载数据？
<ul><li>特指，不是通过浏览器地址栏的请求请求到的数据，就是动态加载数据。同理，动态加载数据一定是通过其他的请求请求到的。</li></ul></li> <li>如何获取动态加载数据？
<ul><li>基于抓包工具进行全局搜索
<ul><li>鼠标点击任意的数据包，然后按下cotrl+f打开全局搜索框，搜索局部你想要的数据，即可定位到包含搜索数据的指定数据包。
<ul><li>从指定数据包中就可以提取出：
<ul><li>url：https://movie.douban.com/j/chart/top_list</li> <li>请求方式：get</li> <li>请求参数：type=13&amp;interval_id=100%3A90&amp;action=&amp;start=0&amp;limit=1</li></ul></li></ul></li></ul></li></ul></li></ul></li> <li><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
head <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">#存放需要伪装的头信息</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36'</span>
<span class="token punctuation">}</span>
pram <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;13&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;interval_id&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;100:90&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;action&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;start&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;limit&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
url <span class="token operator">=</span> <span class="token string">'https://movie.douban.com/j/chart/top_list'</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>head<span class="token punctuation">,</span>params<span class="token operator">=</span>pram<span class="token punctuation">)</span>
<span class="token comment">#获取响应数据</span>
<span class="token comment">#json()可以将获取到的json格式的字符串进行反序列化</span>
page_text <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
fp <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./douban.txt'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> dic <span class="token keyword">in</span> page_text<span class="token punctuation">:</span>
    title <span class="token operator">=</span> dic<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span>
    score <span class="token operator">=</span> dic<span class="token punctuation">[</span><span class="token string">'score'</span><span class="token punctuation">]</span>
    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>title<span class="token operator">+</span><span class="token string">':'</span><span class="token operator">+</span>score<span class="token operator">+</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span><span class="token string">'爬虫保存成功！'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li> <li><p>肯德基</p> <ul><li><p>http://www.kfc.com.cn/kfccda/index.aspx</p> <ul><li><p>将餐厅的位置信息进行数据爬取</p></li> <li><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
head <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">#存放需要伪装的头信息</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36'</span>
<span class="token punctuation">}</span>
<span class="token comment">#post请求的请求参数</span>
data <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;cname&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;pid&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;keyword&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;天津&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;pageIndex&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;pageSize&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;10&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">#在抓包工具中：Form Data存放的是post请求的请求参数，而Query String中存放的是get请求的请求参数</span>
url <span class="token operator">=</span> <span class="token string">'http://www.kfc.com.cn/kfccda/ashx/GetStoreList.ashx?op=keyword'</span>
<span class="token comment">#在post请求中，处理请求参数的是data这个参数不是params</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>head<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
<span class="token comment">#将响应数据进行反序列化</span>
page_text <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> dic <span class="token keyword">in</span> page_text<span class="token punctuation">[</span><span class="token string">'Table1'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> dic<span class="token punctuation">[</span><span class="token string">'storeName'</span><span class="token punctuation">]</span>
    addr <span class="token operator">=</span> dic<span class="token punctuation">[</span><span class="token string">'addressDetail'</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>addr<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li></ul></li></ul></li></ul></li> <li><ul><li><p>药监总局(作业)</p> <ul><li><p>http://scxk.nmpa.gov.cn:81/xk/</p></li> <li><p>要求：抓取每一家企业的企业详情数据</p></li> <li><p>思路：</p> <ul><li><p>1.在对一个陌生的网站进行数据爬取前，首先要确定我们想要爬取的数据是否为动态加载数据？</p> <ul><li><p>先进入到任意一家企业的详情页中，查看企业的详情数据是否为动态加载数据？</p> <ul><li>基于抓包工具进行局部搜索
<ul><li>搜索的到：不是动态加载</li> <li>搜索不到：是动态加载
<ul><li>发现企业的详情数据是动态加载数据</li></ul></li></ul></li></ul></li> <li><p>如何捕获动态加载数据？</p> <ul><li><p>基于抓包工具进行全局搜索，定位到动态加载数据对应的数据包</p> <ul><li><p>url：http://scxk.nmpa.gov.cn:81/xk/itownet/portalAction.do?method=getXkzsById</p></li> <li><p>请求方式：POST</p></li> <li><p>请求参数：id: d601af664b5940029601d6d0a05be321</p></li> <li><p>成功获取了一家企业对应的企业详情数据</p></li> <li><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token comment">#指定url</span>
url <span class="token operator">=</span> <span class="token string">'http://scxk.nmpa.gov.cn:81/xk/itownet/portalAction.do?method=getXkzsById'</span>
<span class="token comment">#请求参数</span>
data <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'id'</span><span class="token punctuation">:</span><span class="token string">'d601af664b5940029601d6d0a05be321'</span>
<span class="token punctuation">}</span>
<span class="token comment">#UA伪装</span>
headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36X-Requested-With: XMLHttpRequest'</span>
<span class="token punctuation">}</span>
<span class="token comment">#发起的post请求</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
<span class="token comment">#获取响应数据</span>
json_data <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#如果确定响应数据为json格式字符串才可以调用json方法实现反序列化</span>
<span class="token comment">#获取企业名称，法人代表，许可证编号</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>json_data<span class="token punctuation">[</span><span class="token string">'epsName'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>json_data<span class="token punctuation">[</span><span class="token string">'legalPerson'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>json_data<span class="token punctuation">[</span><span class="token string">'productSn'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li> <li><p>再次对另一家企业的企业详情数据进行分析</p> <ul><li>定位到了动态加载数据对应的数据包
<ul><li>在该数据包中可以提取到url，请求方式和请求参数，对比发现，不同企业的详情数据的数据包请方式和url是一样的，只有请求参数id的值不一样。</li> <li>结论：不同企业的企业详情数据对应的数据包只有id的参数不同剩下都一样。</li> <li>结果：如果我们可以批量获取多家企业的id值，就可以批量获取多家企业的企业详情数据。</li></ul></li></ul></li> <li><p>如何批量获取多家企业的id值？</p> <ul><li><p>id通常表示一组数据的唯一标识。联想到企业的名称也会作为企业的唯一标识，那么会不会企业的id和企业的名称在页面中是绑定在一起的呢？</p> <ul><li><p>测试：在首页通过企业名称找到企业的id</p> <ul><li><p>通过抓包工具的分析，首页中企业的名称等信息也是动态加载数据。</p> <ul><li><p>捕获动态加载数据。定位到指定的数据包，从数据包的响应数据中发现了不同企业的id，就可以将不同企业的id取到。</p></li> <li><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token comment">#UA伪装</span>
headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36X-Requested-With: XMLHttpRequest'</span>
<span class="token punctuation">}</span>
main_url <span class="token operator">=</span> <span class="token string">'http://scxk.nmpa.gov.cn:81/xk/itownet/portalAction.do?method=getXkzsList'</span>
m_data <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;on&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;page&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;pageSize&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;15&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;productName&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;conditionType&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;applyname&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;applysn&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
m_response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>main_url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>data<span class="token operator">=</span>m_data<span class="token punctuation">)</span>
json_data <span class="token operator">=</span> m_response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> dic <span class="token keyword">in</span> json_data<span class="token punctuation">[</span><span class="token string">'list'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    _id <span class="token operator">=</span> dic<span class="token punctuation">[</span><span class="token string">'ID'</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>_id<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li></ul></li></ul></li></ul></li> <li><p>整体代码整合：</p> <ul><li><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
<span class="token comment">#UA伪装</span>
headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36X-Requested-With: XMLHttpRequest'</span>
<span class="token punctuation">}</span>
main_url <span class="token operator">=</span> <span class="token string">'http://scxk.nmpa.gov.cn:81/xk/itownet/portalAction.do?method=getXkzsList'</span>
m_data <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;on&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;page&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;pageSize&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;15&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;productName&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;conditionType&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;applyname&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;applysn&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
m_response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>main_url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>data<span class="token operator">=</span>m_data<span class="token punctuation">)</span>
json_data <span class="token operator">=</span> m_response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">#存储多家企业的id</span>
<span class="token keyword">for</span> dic <span class="token keyword">in</span> json_data<span class="token punctuation">[</span><span class="token string">'list'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    _id <span class="token operator">=</span> dic<span class="token punctuation">[</span><span class="token string">'ID'</span><span class="token punctuation">]</span>
    ids<span class="token punctuation">.</span>append<span class="token punctuation">(</span>_id<span class="token punctuation">)</span>

<span class="token comment">#循环对每一家企业的详情数据进行获取</span>
<span class="token keyword">for</span> _id <span class="token keyword">in</span> ids<span class="token punctuation">:</span>
    <span class="token comment">#指定url</span>
    url <span class="token operator">=</span> <span class="token string">'http://scxk.nmpa.gov.cn:81/xk/itownet/portalAction.do?method=getXkzsById'</span>
    <span class="token comment">#请求参数</span>
    data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'id'</span><span class="token punctuation">:</span>_id
    <span class="token punctuation">}</span>
    <span class="token comment">#发起的post请求</span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    <span class="token comment">#获取响应数据</span>
    json_data <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#如果确定响应数据为json格式字符串才可以调用json方法实现反序列化</span>
    <span class="token comment">#获取企业名称，法人代表，许可证编号</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>json_data<span class="token punctuation">[</span><span class="token string">'epsName'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>json_data<span class="token punctuation">[</span><span class="token string">'legalPerson'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>json_data<span class="token punctuation">[</span><span class="token string">'productSn'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul> <h2 id="数据解析"><a href="#数据解析" class="header-anchor">#</a> 数据解析</h2> <h3 id="何为数据解析"><a href="#何为数据解析" class="header-anchor">#</a> 何为数据解析</h3> <ul><li>概念：就是将爬取到数据中局部的指定的数据进行提取</li> <li>作用：实现聚焦爬虫</li> <li>数据解析通用原理：
<ul><li>html是用来展示数据，html中展示的数据正是我们要爬取或者采集的数据</li> <li>html所展示的数据/想要爬取的数据只会存在于标签之间或者标签的属性中</li> <li>数据解析的通用原理：
<ul><li>标签定位</li> <li>提取标签中存储的数据</li></ul></li></ul></li> <li>聚焦爬虫编码流程
<ul><li>指定url</li> <li>发起请求</li> <li>获取响应数据</li> <li>数据解析</li> <li>持久化存储</li></ul></li></ul> <h3 id="数据解析的主流策略"><a href="#数据解析的主流策略" class="header-anchor">#</a> 数据解析的主流策略</h3> <ul><li><p>如何爬取多媒体资源（图片，音频，视频，动图）</p> <ul><li><p>方式1：编写麻烦，但是可以实现UA伪装</p> <ul><li><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests
headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36X-Requested-With: XMLHttpRequest'</span>
<span class="token punctuation">}</span>
<span class="token comment">#获取图片地址：通常为img标签的src属性值</span>
img_src <span class="token operator">=</span> <span class="token string">'http://img.itlun.cn/uploads/allimg/180506/1-1P5061TS6-lp.jpg'</span>
<span class="token comment">#对图片发起请求</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>img_src<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
<span class="token comment">#获取图片数据:content返回的是二进制形式的响应数据</span>
img_data <span class="token operator">=</span> response<span class="token punctuation">.</span>content
<span class="token comment">#持久化存储</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./123.jpg'</span><span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>img_data<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ul></li> <li><p>方式2：编写简单，但是无法实现UA伪装</p> <ul><li><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> urllib <span class="token keyword">import</span> request

img_src <span class="token operator">=</span> <span class="token string">'http://img.itlun.cn/uploads/allimg/180506/1-1P5061TS6-lp.jpg'</span>
<span class="token comment">#urlretrieve可以直接对图片发起请求，且将请求到的图片数据进行持久化存储</span>
request<span class="token punctuation">.</span>urlretrieve<span class="token punctuation">(</span>img_src<span class="token punctuation">,</span><span class="token string">'./456.jpg'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul></li></ul></li> <li><p>正则（基本掌握）</p> <ul><li><p>案例应用：批量爬取图片</p> <ul><li><p>url：http://md.itlun.cn/a/nhtp/</p></li> <li><p>大致思路：</p> <ul><li>将页面中每一张图片的图片地址解析出来</li> <li>对图片地址发起请求获取图片数据，然后进行持久化存储</li></ul></li> <li><p>注意：</p> <ul><li>开发者工具中Elements选项卡中显示的页面源码数据（会包含动态加载数据）：
<ul><li>是通过所有数据包请求到的数据渲染完毕后的完整数据</li></ul></li> <li>抓包工具Network中response显示的页面源码数据：（不包含动态加载数据）
<ul><li>其实就是通过requests模块对该数据包的url发起请求获取的响应数据</li> <li>单独该数据包请求到的响应数据</li></ul></li></ul></li> <li><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> urllib <span class="token keyword">import</span> request
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> re
main_url <span class="token operator">=</span> <span class="token string">'http://md.itlun.cn/a/nhtp/'</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>main_url<span class="token punctuation">)</span>
<span class="token comment">#处理页面中的中文乱码</span>
response<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'gbk'</span>
<span class="token comment">#获取了页面源码数据</span>
page_text <span class="token operator">=</span> response<span class="token punctuation">.</span>text

<span class="token comment">#数据解析：解析图片的地址</span>
<span class="token comment"># ex = '&lt;li&gt;.*?&lt;img.*?src=&quot;(.*?)&quot; style.*?&lt;/li&gt;'</span>
<span class="token comment">#re.S用来处理回车</span>
<span class="token comment"># img_src_list = re.findall(ex,page_text,re.S)</span>
<span class="token comment">#注意：如果确认正则没有写错，则取关注下正则作用到的页面源码是否出现问题</span>
<span class="token comment">#极有可能页面源码数据出现了动态加载的情况</span>
<span class="token comment">#在抓包工具中，查看了数据包的响应数据，发现img，li标签都是大写，而我们写的正则匹配的是小写标签，因此匹配失败</span>
<span class="token comment"># ex = '&lt;LI&gt;.*?&lt;IMG.*?src=&quot;(.*?)&quot; style.*?&lt;/LI&gt;'</span>
<span class="token comment"># img_src_list = re.findall(ex,page_text,re.S)</span>
<span class="token comment">#问题：提取到的图片地址都是一样的。如何解决？继续查看抓包工具的源码</span>
<span class="token comment">#发现：真正的图片地址是有js动态加载出来的</span>
ex <span class="token operator">=</span> <span class="token string">'&lt;script.*?src = &quot;(.*?)&quot;; &lt;/script&gt;'</span>
img_src_list <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>ex<span class="token punctuation">,</span>page_text<span class="token punctuation">,</span>re<span class="token punctuation">.</span>S<span class="token punctuation">)</span>
<span class="token comment">#发现解析出的图片地址，是不完整的，缺少http:</span>
<span class="token keyword">for</span> img_src <span class="token keyword">in</span> img_src_list<span class="token punctuation">:</span>
    img_src <span class="token operator">=</span> <span class="token string">'http:'</span><span class="token operator">+</span>img_src
    <span class="token comment"># print(img_src)</span>
    img_name <span class="token operator">=</span> img_src<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    request<span class="token punctuation">.</span>urlretrieve<span class="token punctuation">(</span>img_src<span class="token punctuation">,</span>img_name<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>img_name<span class="token punctuation">,</span><span class="token string">'下载成功！'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div></li></ul></li></ul></li> <li><p>bs4（重点）</p> <ul><li><p>环境安装：pip install bs4</p></li> <li><p>bs4数据解析的流程</p> <ul><li>1.实例化一个BeautifulSoup的对象，然后把即将被解析的页面源码数据加载到该对象中
<ul><li>BeautifulSoup(fp,'lxml'):fp表示本地的一个文件，该种方式是将本地存储的html文件进行数据解析</li> <li>BeautifulSoup(page_text,'lxml'):page_text是网络请求到的页面源码数据，该种方式是直接将网络请求到的页面源码数据进行数据解析</li></ul></li> <li>2.调用BeautifulSoup对象中相关的属性和方法实现标签定位和数据提取</li></ul></li> <li><p>具体解析的操作：</p> <ul><li><p>在当前目录下新建一个test.html文件，然后将下述内容拷贝到该文件中</p> <ul><li><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>测试bs4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>百里守约<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>song<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>李清照<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>王安石<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>苏轼<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>柳宗元<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.song.com/<span class="token punctuation">&quot;</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>赵匡胤<span class="token punctuation">&quot;</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_self<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>this is span<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
		宋朝是最强大的王朝，不是军队的强大，而是经济很强大，国民都很有钱<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>du<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>总为浮云能蔽日,长安不见使人愁<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.baidu.com/meinv.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tang<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.baidu.com<span class="token punctuation">&quot;</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>qing<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>清明时节雨纷纷,路上行人欲断魂,借问酒家何处有,牧童遥指杏花村<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.163.com<span class="token punctuation">&quot;</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>qin<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>秦时明月汉时关,万里长征人未还,但使龙城飞将在,不教胡马度阴山<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.126.com<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>qi<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>岐王宅里寻常见,崔九堂前几度闻,正是江南好风景,落花时节又逢君<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.sina.com<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>du<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>杜甫<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.dudu.com<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>du<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>杜牧<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>杜小月<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span><span class="token punctuation">&gt;</span></span>度蜜月<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.haha.com<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>feng<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>凤凰台上凤凰游,凤去台空江自流,吴宫花草埋幽径,晋代衣冠成古丘<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div></li></ul></li> <li><p>有了test.html文件后，在练习如下操作</p> <ul><li><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token comment">#fp就表示本地存储的一个html文件</span>
fp <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./test.html'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
<span class="token comment">#解析本地存储的html文件中的内容</span>
<span class="token comment">#实例化BeautifulSoup对象，然后把即将被解析的页面源码数据加载到了该对象中</span>
soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>fp<span class="token punctuation">,</span><span class="token string">'lxml'</span><span class="token punctuation">)</span> <span class="token comment">#参数2，lxml是固定形式，表示指定的解析器</span>
<span class="token comment">#标签定位</span>
<span class="token comment">#方式1：soup.tagName,只会定位到符合条件的第一个标签</span>
tag1 <span class="token operator">=</span> soup<span class="token punctuation">.</span>title <span class="token comment">#定位到了title标签</span>
tag2 <span class="token operator">=</span> soup<span class="token punctuation">.</span>div
<span class="token comment">#方式2：属性定位，find函数，findall函数</span>
    <span class="token comment">#find('tagName',attrName='attrValue')：find只会定位到满足要的第一个标签</span>
tag3 <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'song'</span><span class="token punctuation">)</span><span class="token comment">#定位class属性值为song的div标签</span>
tag4 <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token string">'feng'</span><span class="token punctuation">)</span><span class="token comment">#定位id属性值为feng的a标签</span>
    <span class="token comment">#findAll('tagName',attrName='attrValue')：可以定位到满足要求的所有标签</span>
tag5 <span class="token operator">=</span> soup<span class="token punctuation">.</span>findAll<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'song'</span><span class="token punctuation">)</span>
<span class="token comment">#方式3：选择器定位：soup.select('选择器')</span>
    <span class="token comment">#id选择器：#feng  ----id为feng</span>
    <span class="token comment">#class选择器：.song ----class为song</span>
    <span class="token comment">#层级选择器：大于号表示一个层级，空格表示多个层级</span>
tag6 <span class="token operator">=</span> soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'#feng'</span><span class="token punctuation">)</span> <span class="token comment">#定位到所有id属性值为feng的标签</span>
tag7 <span class="token operator">=</span> soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'.song'</span><span class="token punctuation">)</span><span class="token comment">#定位到所有class属性值为song的标签</span>
tag8 <span class="token operator">=</span> soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'.tang &gt; ul &gt; li'</span><span class="token punctuation">)</span> <span class="token comment">#定位到了class为tang下面的ul下面所有的li标签</span>
tag9 <span class="token operator">=</span> soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'.tang li'</span><span class="token punctuation">)</span>

<span class="token comment">#提取标签中的内容</span>
<span class="token comment">#1.提取标签中间的内容：</span>
    <span class="token comment">#tag.string:只可以提取到标签中直系的文本内容</span>
    <span class="token comment">#tag.text:可以提取到标签中所有的文本内容</span>
<span class="token comment"># p_tag = soup.p</span>
<span class="token comment"># print(p_tag.string)</span>
<span class="token comment"># print(p_tag.text)</span>
<span class="token comment"># div_tag = soup.find('div',class_='song')</span>
<span class="token comment"># print(div_tag.text)</span>

<span class="token comment">#2.提取标签的属性值</span>
    <span class="token comment">#tag['attrName']</span>
img_tag <span class="token operator">=</span> soup<span class="token punctuation">.</span>img
<span class="token keyword">print</span><span class="token punctuation">(</span>img_tag<span class="token punctuation">[</span><span class="token string">'src'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#提取img标签的src的属性值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div></li></ul></li></ul></li> <li><p>案例应用：小说批量爬取</p> <ul><li><p>url：https://www.shicimingju.com/book/sanguoyanyi.html</p></li> <li><p>需求：将每一个章节的标题和内容进行爬取然后存储到一个文件中</p> <ul><li>步骤：
<ul><li>1.请求主页的页面源码数据</li> <li>2.数据解析：
<ul><li>章节标题</li> <li>章节详情页的链接</li></ul></li> <li>3.解析章节详细内容</li> <li>4.将解析的章节标题和内容进行存储</li></ul></li></ul></li> <li><div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> requests
headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36'</span>
<span class="token punctuation">}</span>
<span class="token comment">#首页地址</span>
main_url <span class="token operator">=</span> <span class="token string">'https://www.shicimingju.com/book/sanguoyanyi.html'</span>
<span class="token comment">#发起请求，获取了主页页面源码</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>main_url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
response<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span>
page_text <span class="token operator">=</span> response<span class="token punctuation">.</span>text
<span class="token comment">#数据解析：章节标题+详情页链接</span>
soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>page_text<span class="token punctuation">,</span><span class="token string">'lxml'</span><span class="token punctuation">)</span>
a_list <span class="token operator">=</span> soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'.book-mulu &gt; ul &gt; li &gt; a'</span><span class="token punctuation">)</span>
fp <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./sanguo.txt'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> a <span class="token keyword">in</span> a_list<span class="token punctuation">:</span>
    title <span class="token operator">=</span> a<span class="token punctuation">.</span>string <span class="token comment">#章节标题</span>
    detail_url <span class="token operator">=</span> <span class="token string">'https://www.shicimingju.com'</span><span class="token operator">+</span>a<span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span> <span class="token comment">#详情页地址</span>
    <span class="token comment">#请求详情页的页面源码数据</span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>detail_url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    response<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span>
    detail_page_text <span class="token operator">=</span> response<span class="token punctuation">.</span>text
    <span class="token comment">#解析：解析章节内容</span>
    d_soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>detail_page_text<span class="token punctuation">,</span><span class="token string">'lxml'</span><span class="token punctuation">)</span>
    div_tag <span class="token operator">=</span> d_soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'chapter_content'</span><span class="token punctuation">)</span>
    content <span class="token operator">=</span> div_tag<span class="token punctuation">.</span>text <span class="token comment">#章节内容</span>
    fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>title<span class="token operator">+</span><span class="token string">':'</span><span class="token operator">+</span>content<span class="token operator">+</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span><span class="token string">'爬取保存成功！'</span><span class="token punctuation">)</span>
fp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div></li></ul></li> <li><p>案例应用：代理批量爬取</p> <ul><li><p>url：https://www.kuaidaili.com/free</p></li> <li><p>需求：将前5页的所有id和port解析且存储到文件中</p></li> <li><div class="language- line-numbers-mode"><pre class="language-text"><code>#只爬取了第一页的内容
from bs4 import BeautifulSoup
import requests
headers = {
    'User-Agent':'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36'
}
url = 'https://www.kuaidaili.com/free'
page_text = requests.get(url=url,headers=headers).text
soup = BeautifulSoup(page_text,'lxml')
trs = soup.select('tbody &gt; tr')
for tr in trs:
    t1 = tr.findAll('td')[0]
    t2 = tr.findAll('td')[1]
    ip = t1.string
    port = t2.string
    print(ip,port)

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li></ul></li></ul></li> <li></li></ul></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----></main> <!----> <div class="comments-wrapper" data-v-4698c43e><!----></div></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-44bd5a18 data-v-44bd5a18><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-44bd5a18><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-44bd5a18></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-44bd5a18></path></svg></div><!----><div></div><!----><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="https://music.163.com/song/media/outer/url?id=316756.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:200px;z-index:999999;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="https://p2.music.126.net/qOOTIykbSLw9RHB0vI83GA==/737772302281958.jpg" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(https://p2.music.126.net/qOOTIykbSLw9RHB0vI83GA==/737772302281958.jpg);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>大城小事</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>杨千嬅</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div><!----><div class="kanbanniang" data-v-5775ee02><div class="banniang-container" style="display:;" data-v-5775ee02><div class="messageBox" style="right:68px;bottom:190px;display:none;" data-v-5775ee02>
      欢迎来到 shankele-小站
    </div> <div class="operation" style="right:90px;bottom:40px;display:;" data-v-5775ee02><i class="kbnfont kbn-ban-home ban-home" data-v-5775ee02></i> <i class="kbnfont kbn-ban-message message" data-v-5775ee02></i> <i class="kbnfont kbn-ban-close close" data-v-5775ee02></i> <a target="_blank" href="https://vuepress-theme-reco.recoluan.com/views/plugins/kanbanniang.html" data-v-5775ee02><i class="kbnfont kbn-ban-info info" data-v-5775ee02></i></a> <i class="kbnfont kbn-ban-theme skin" style="display:none;" data-v-5775ee02></i></div> <canvas id="banniang" width="150" height="220" class="live2d" style="right:90px;bottom:-20px;opacity:0.9;" data-v-5775ee02></canvas></div> <div class="showBanNiang" style="display:none;" data-v-5775ee02>
    看板娘
  </div></div></div></div>
    <script src="/assets/js/app.ab61940f.js" defer></script><script src="/assets/js/4.af0e03a7.js" defer></script><script src="/assets/js/1.d11c8c07.js" defer></script><script src="/assets/js/15.55dfe66d.js" defer></script><script src="/assets/js/10.29aea2aa.js" defer></script>
  </body>
</html>
